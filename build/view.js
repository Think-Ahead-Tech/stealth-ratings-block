document.querySelectorAll(".wp-block-stealth-ratings-block-stealth-ratings-block").forEach(((t,e)=>{const n=t.querySelectorAll(".star"),s=t.querySelector(".stealth-ratings-form"),i=t.querySelector(".stealth-ratings-success"),a=t.querySelector(".stealth-ratings-redirect"),r=t.querySelector(".stealth-ratings-caption"),l=t.dataset.businessName||"",o=t.dataset.externalUrl||"",d=parseInt(t.dataset.threshold,10)||4;let c=0,y=!1;function u(t=0){n.forEach(((e,n)=>{t?e.classList.toggle("filled",n<t):e.classList.toggle("filled",n<c)}))}n.forEach(((t,e)=>{t.addEventListener("mouseenter",(()=>u(e+1))),t.addEventListener("mouseleave",(()=>u())),t.addEventListener("focus",(()=>u(e+1))),t.addEventListener("blur",(()=>u())),t.addEventListener("click",(()=>{y||(c=e+1,u(),r.style.display="none",c<=d?(s.style.display="",i.style.display="none",a.style.display="none"):o&&setTimeout((()=>{window.location.href=o}),1500))})),t.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t.click())})),t.setAttribute("tabindex","0")})),s&&s.addEventListener("submit",(function(t){t.preventDefault();const e=s.querySelector('input[name="name"]').value,n=s.querySelector('textarea[name="feedback"]').value;s.querySelector('button[type="submit"]').disabled=!0,fetch("/wp-json/stealth-ratings/v1/send-feedback",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.StealthRatingsBlock&&window.StealthRatingsBlock.nonce?window.StealthRatingsBlock.nonce:""},body:JSON.stringify({name:e,message:n,rating:c})}).then((t=>t.json())).then((t=>{if(!t||!t.success)throw new Error("Submission failed");s.style.display="none",i.style.display="",a.style.display="none",i.innerHTML=`\n\t\t\t\t\t\t\t<div class="components-notice is-success stealth-ratings-success-message" style="margin-top:2rem;text-align:center;">\n\t\t\t\t\t\t\t\t<div style="font-size:1.6rem;line-height:1;margin-bottom:0.5rem;">âœ…</div>\n\t\t\t\t\t\t\t\t<div style="font-size:1.15rem;font-weight:600;">Feedback Received</div>\n\t\t\t\t\t\t\t\t<div style="margin:1rem 0 0.5rem 0;">Thank you${e?", "+e:""}!</div>\n\t\t\t\t\t\t\t\t<div style="font-size:1rem;line-height:1.4;">Your feedback has been received and will help <b>${l}</b> improve.<br>We appreciate you taking the time to share your thoughts with us.</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`})).catch((()=>{i.style.display="",i.innerHTML='<div class="components-notice is-error" style="margin-top:2rem;text-align:center;">\n\t\t\t\t\t\t<div style="font-size:1.2rem;font-weight:600;">Submission failed</div>\n\t\t\t\t\t\t<div style="margin:1rem 0 0.5rem 0;">Sorry, there was a problem sending your feedback. Please try again later.</div>\n\t\t\t\t\t</div>'})).finally((()=>{s.querySelector('button[type="submit"]').disabled=!1,y=!0}))}))}));